<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ğŸ” AnÃ¡lisis FilosÃ³fico con IA</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="lib/pdf.min.js"></script>
  <script src="lib/mammoth.browser.min.js"></script>
</head>
<body>

  <!-- Fondo de estrellas -->
  <div class="stars"></div>

  <!-- MenÃº superior -->
  <nav class="navbar">
    <div class="logo">Î‘Î›Î—Î˜Î•Î™Î‘</div>
    <div class="subtitle">AnÃ¡lisis FilosÃ³fico con IA</div>
  </nav>

  <main class="container">
    <h1 class="glow-text">Analiza cualquier texto filosÃ³fico con IA</h1>
    <p class="subtitle">Sube tu documento o pÃ©galo directamente.</p>

    <!-- Formulario -->
    <section class="form-section">
      <label for="titulo">TÃ­tulo del texto:</label>
      <input type="text" id="titulo" placeholder="Ej: 'La libertad como responsabilidad'" />

      <label for="archivo">Sube tu documento (PDF, DOCX, TXT):</label>
      <input type="file" id="archivo" accept=".pdf,.docx,.txt,.rtf" />

      <div id="texto-container" class="hidden">
        <label for="texto">Texto extraÃ­do:</label>
        <textarea id="texto" rows="10" readonly></textarea>
      </div>

      <button id="analizar-btn" class="btn-glow">ğŸš€ Analizar con IA</button>
    </section>

    <!-- Resultado -->
    <section id="resultado" class="result-section hidden">
      <h2 class="neon-title">ğŸ“Š AnÃ¡lisis de AletheIA</h2>
      <div id="analisis-ia"></div>
    </section>

    <!-- ComparaciÃ³n -->
    <section id="comparacion" class="comparison hidden">
      <h2 class="neon-title">ğŸ” ComparaciÃ³n: Tu anÃ¡lisis vs. IA</h2>
      <div id="comparacion-contenido"></div>
    </section>
  </main>

  <footer class="footer">
    <p class="neon-text">âœ¨ Î— Ï†Î¹Î»Î¿ÏƒÎ¿Ï†Î¯Î± ÎµÎ¯Î½Î±Î¹ Î· Ï€ÏÏÏ„Î· Î±ÏƒÏ„ÏÎ¿Î½Î¿Î¼Î¯Î± Ï„Î·Ï‚ ÏˆÏ…Ï‡Î®Ï‚. âœ¨</p>
    <p class="small">Â© 2025 | AletheIA â€” Pensando contigo.</p>
  </footer>

  <script>
    const OPENAI_API_KEY = "tu-api-key-aquÃ­"; // ğŸ”‘ Reemplaza con tu clave real

    const analizarBtn = document.getElementById("analizar-btn");
    const tituloInput = document.getElementById("titulo");
    const archivoInput = document.getElementById("archivo");
    const textoContainer = document.getElementById("texto-container");
    const textoTextarea = document.getElementById("texto");
    const resultadoSection = document.getElementById("resultado");
    const comparacionSection = document.getElementById("comparacion");
    const analisisIaDiv = document.getElementById("analisis-ia");
    const comparacionContenido = document.getElementById("comparacion-contenido");

    const promptTemplate = `
      Eres un asistente filosÃ³fico experto. Analiza el siguiente texto filosÃ³fico usando la plantilla del Colegio de la Bici.
      Usa el mismo formato. Responde en JSON con todos los campos.

      Texto:
      "{{input_text}}"

      TÃ­tulo: "{{input_title}}"
      Fecha: {{current_date}}

      Devuelve solo el JSON con el anÃ¡lisis completo.
    `;

    function generarPrompt() {
      const inputText = textoTextarea.value.trim();
      const inputTitle = tituloInput.value || "Sin tÃ­tulo";
      const currentDate = new Date().toISOString().split('T')[0];

      return promptTemplate
        .replace("{{input_text}}", inputText)
        .replace("{{input_title}}", inputTitle)
        .replace("{{current_date}}", currentDate);
    }

    archivoInput.addEventListener("change", async function(e) {
      const file = e.target.files[0];
      if (!file) return;

      try {
        if (file.name.endsWith(".txt")) {
          const text = await file.text();
          textoTextarea.value = text;
          textoContainer.classList.remove("hidden");
          return;
        }

        if (file.name.endsWith(".pdf")) {
          const arrayBuffer = await file.arrayBuffer();
          const pdf = await pdfjsLib.getDocument({ arrayBuffer }).promise;
          let fullText = "";
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const content = await page.getTextContent();
            fullText += content.items.map(item => item.str).join(" ") + " ";
          }
          textoTextarea.value = fullText;
          textoContainer.classList.remove("hidden");
          return;
        }

        if (file.name.endsWith(".docx")) {
          const arrayBuffer = await file.arrayBuffer();
          const result = await mammoth.extractRawText({ arrayBuffer });
          textoTextarea.value = result.value;
          textoContainer.classList.remove("hidden");
          return;
        }

        alert("Formato no soportado. Usa .txt, .pdf o .docx.");
      } catch (error) {
        console.error("Error al leer el archivo:", error);
        alert("No se pudo leer el archivo. Intenta otro formato.");
      }
    });

    async function analizarConIA() {
      const prompt = generarPrompt();

      try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${OPENAI_API_KEY}`
          },
          body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [
              { role: "system", content: "Eres un experto en filosofÃ­a. Analiza textos con rigor, profundidad y estilo claro." },
              { role: "user", content: prompt }
            ],
            temperature: 0.7,
            max_tokens: 2000
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error?.message || "Error en la API de OpenAI");
        }

        const rawResponse = data.choices[0].message.content;
        let analysis;

        try {
          analysis = JSON.parse(rawResponse);
        } catch (e) {
          console.error("Error al parsear JSON:", e);
          alert("Error: La IA no devolviÃ³ un JSON vÃ¡lido.");
          return;
        }

        mostrarResultado(analysis);
      } catch (error) {
        console.error("Error en OpenAI:", error);
        alert("Error al conectar con la IA. Verifica tu clave API.");
      }
    }

    function mostrarResultado(analysis) {
      analisisIaDiv.innerHTML = "";

      const keys = [
        "TEMA", "TERMINOS FILOSOFICOS", "TESIS", "ARGUMENTOS",
        "Â¿SON VÃLIDOS LOS ARGUMENTOS?", "UTILIDAD PRACTICA",
        "Â¿QUÃ‰ APRENDÃ?", "Â¿CÃ“MO LO APRENDI?", "Â¿QUÃ‰ ENTENDÃ DEL TEMA?",
        "Â¿QUÃ‰ ME LLAMÃ“ MÃS LA ATENCIÃ“N?", "Â¿QUÃ‰ PREGUNTAS TENGO SOBRE LA LECTURA?",
        "Â¿CÃ“MO PUEDO USAR LO QUE APRENDÃ EN EL FUTURO?"
      ];

      keys.forEach(key => {
        const div = document.createElement("div");
        div.classList.add("field");
        div.innerHTML = `<strong>${key}:</strong> ${formatValue(analysis.analisis[key])}`;
        analisisIaDiv.appendChild(div);
      });

      resultadoSection.classList.remove("hidden");
      comparacionSection.classList.remove("hidden");
      comparacionContenido.innerHTML = "<p>Â¡Compara tus respuestas con el anÃ¡lisis de AletheIA!</p>";
    }

    function formatValue(value) {
      if (Array.isArray(value)) {
        return value.join(", ");
      }
      return value || "No especificado";
    }

    analizarBtn.addEventListener("click", analizarConIA);

    window.onload = () => {
      tituloInput.value = "La filosofÃ­a es la prÃ¡ctica radical...";
      textoTextarea.value = "La filosofÃ­a es la prÃ¡ctica radical y reflexiva de cuestionar las condiciones bajo las cuales se hace posible la realidad, el conocimiento, el sentido y la libertad, pero no como un fin en sÃ­ misma, sino como una forma de abrir el mundo, liberar el pensamiento del dogma y recuperar la dignidad humana. No es un cuerpo de verdades ni un conjunto de respuestas, sino una participaciÃ³n viva, creativa y Ã©tica en las preguntas fundamentales de la existencia: Â¿quiÃ©nes somos? Â¿por quÃ© estamos aquÃ­? Â¿cÃ³mo debemos vivir? Y Â¿quÃ© significa ser humano en relaciÃ³n con los demÃ¡s, con la naturaleza y con el cosmos?";
      textoContainer.classList.remove("hidden");
    };
  </script>

</body>
</html>